# Makefile for PuTTY 0.83 — OpenWatcom wcl386, Win32 target
#
# Run from the windows/ directory:
#   wmake -f Makefile.wc
#
# This Makefile was written by hand for the 0.83 source layout, which
# reorganised crypto→crypto/, SSH protocol→ssh/, utilities→utils/,
# Windows utilities→windows/utils/, and terminal→terminal/.
#
# No cmake.h is generated here, so HAVE_CMAKE_H is not defined.
# The crypto layer falls back to pure-software implementations (no
# AES-NI, no ARM NEON); platform-accelerated files (aes-ni.c, etc.)
# are intentionally excluded.
#
# Tool path: set TOOLPATH if windres is not on PATH.

CC       = wcl386
RC       = i686-w64-mingw32-windres
TOOLPATH =
RCPATH   = $(TOOLPATH)$(RC)

# -----------------------------------------------------------------
# Compiler / linker flags
# -----------------------------------------------------------------

COMPAT = -DNO_GSSAPI -DNO_IPV6 -DNO_MULTIMON &
         -DNO_HTMLHELP &
         -DWIN32S_COMPAT -DLEGACY_WINDOWS

CFLAGS = -za99 -bt=nt -od -D_WINDOWS -D_WIN32 -DWIN32 &
         -D_NO_OLDNAMES &
         -DHAVE_STRTOUMAX=1 &
         -DHAVE_GCP_RESULTSW=1 &
         -I.. -I../terminal -I../ssh -I../crypto &
         -I../utils -I../keygen -I../proxy -I../windows

LDFLAGS = -s

# windres output format: binary .res (bound post-link by wrc)
RCFLAGS = -O res --define WIN32=1 --define _WIN32=1 --define WINVER=0x0400 &
          --define HAVE_WINRESRC_H=1 &
          --define NO_MANIFESTS=1 &
          -I.. -I../windows

# -----------------------------------------------------------------
# Generic compile rule (for files in the same directory as Makefile)
# -----------------------------------------------------------------

.c.obj: .autodepend
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# OBJ_UTILS — utils/*.c  +  stubs/null-*.c
# =================================================================

OBJ_UTILS = &
	antispoof.obj &
	base64_decode.obj &
	base64_decode_atom.obj &
	base64_encode.obj &
	base64_encode_atom.obj &
	base64_valid.obj &
	bufchain.obj &
	buildinfo.obj &
	burnstr.obj &
	burnwcs.obj &
	cert-expr.obj &
	chomp.obj &
	cmdline_get_passwd_input_state_new.obj &
	conf.obj &
	conf_data.obj &
	conf_debug.obj &
	conf_dest.obj &
	conf_launchable.obj &
	ctrlparse.obj &
	ctrlset_normalise.obj &
	debug.obj &
	decode_utf8.obj &
	decode_utf8_to_wchar.obj &
	decode_utf8_to_wide_string.obj &
	default_description.obj &
	dupcat.obj &
	dupprintf.obj &
	dupstr.obj &
	dupwcs.obj &
	dupwcscat.obj &
	dup_mb_to_wc.obj &
	dup_wc_to_mb.obj &
	encode_utf8.obj &
	encode_wide_string_as_utf8.obj &
	fgetline.obj &
	host_ca_new_free.obj &
	host_strchr.obj &
	host_strchr_internal.obj &
	host_strcspn.obj &
	host_strduptrim.obj &
	host_strrchr.obj &
	key_components.obj &
	log_proxy_stderr.obj &
	make_spr_sw_abort_static.obj &
	marshal.obj &
	memory.obj &
	memxor.obj &
	nullstrcmp.obj &
	out_of_memory.obj &
	parse_blocksize.obj &
	percent_decode.obj &
	percent_encode.obj &
	prompts.obj &
	ptrlen.obj &
	read_file_into.obj &
	seat_connection_fatal.obj &
	seat_dialog_text.obj &
	seat_nonfatal.obj &
	sessprep.obj &
	sk_free_peer_info.obj &
	smemclr.obj &
	smemeq.obj &
	spr_get_error_message.obj &
	ssh_key_clone.obj &
	ssh2_pick_fingerprint.obj &
	sshutils.obj &
	strbuf.obj &
	string_length_for_printf.obj &
	stripctrl.obj &
	tempseat.obj &
	tree234.obj &
	unicode-known.obj &
	unicode-norm.obj &
	validate_manual_hostkey.obj &
	version.obj &
	wcwidth.obj &
	wildcard.obj &
	wordwrap.obj &
	write_c_string_literal.obj &
	commit.obj &
	null-cipher.obj &
	null-key.obj &
	null-lp.obj &
	null-mac.obj &
	null-opener.obj &
	null-plug.obj &
	null-seat.obj &
	null-socket.obj

# =================================================================
# OBJ_UTILS_SOCKETS — utils objects needing sk_*/logevent.
# Included in all network-capable targets but NOT puttygen.
# =================================================================

OBJ_UTILS_SOCKETS = &
	backend_socket_log.obj &
	logeventf.obj &
	x11authfile.obj &
	x11authnames.obj

# =================================================================
# OBJ_UTILS_X11 — X11 forwarding utilities needed only for SSH X11 forwarding.
# x11_make_greeting.c needs des_encrypt_xdmauth (crypto/des.c).
# x11_dehexify and x11_identify_auth_proto are called by ssh/sharing.c.
# Only included in SSH-capable targets (putty, plink, pscp, psftp).
# NOT in puttytel (no SSH) or pageant (no X11 forwarding).
# =================================================================

OBJ_UTILS_X11 = &
	x11_dehexify.obj &
	x11_identify_auth_proto.obj &
	x11_make_greeting.obj &
	x11_parse_ip.obj

# =================================================================
# OBJ_CRYPTO — crypto/*.c (software-only; no -ni.c/-neon.c)
# =================================================================

OBJ_CRYPTO = &
	aes-common.obj &
	aes-select.obj &
	aes-sw.obj &
	aesgcm-common.obj &
	aesgcm-select.obj &
	aesgcm-sw.obj &
	aesgcm-ref-poly.obj &
	arcfour.obj &
	argon2.obj &
	bcrypt.obj &
	blake2.obj &
	blowfish.obj &
	chacha20-poly1305.obj &
	crc32.obj &
	des.obj &
	diffie-hellman.obj &
	crypto_dsa.obj &
	ecc-arithmetic.obj &
	ecc-ssh.obj &
	hash_simple.obj &
	hmac.obj &
	kex-hybrid.obj &
	mac.obj &
	mac_simple.obj &
	md5.obj &
	mlkem.obj &
	mpint.obj &
	ntru.obj &
	prng.obj &
	pubkey-pem.obj &
	pubkey-ppk.obj &
	pubkey-ssh1.obj &
	rfc6979.obj &
	crypto_rsa.obj &
	sha1-common.obj &
	sha1-select.obj &
	sha1-sw.obj &
	sha256-common.obj &
	sha256-select.obj &
	sha256-sw.obj &
	sha3.obj &
	sha512-common.obj &
	sha512-select.obj &
	sha512-sw.obj &
	xdmauth.obj

# Also pulled in at the root level by the crypto library:
OBJ_CRYPTO_ROOT = &
	proxy_cproxy.obj &
	sshproxy.obj

# =================================================================
# OBJ_SSH — ssh/*.c (client-side protocol stack)
# =================================================================

OBJ_SSHCOMMON = &
	bpp1.obj &
	bpp2.obj &
	bpp-bare.obj &
	ssh_censor1.obj &
	ssh_censor2.obj &
	ssh_common.obj &
	connection1.obj &
	connection2.obj &
	crc-attack-detector.obj &
	gssc.obj &
	login1.obj &
	pgssapi.obj &
	portfwd.obj &
	transient-hostkey-cache.obj &
	transport2.obj &
	verstring.obj &
	x11fwd.obj &
	ssh_zlib.obj

OBJ_SSHCLIENT = &
	agentf.obj &
	connection1-client.obj &
	connection2-client.obj &
	kex2-client.obj &
	mainchan.obj &
	ssh_sharing.obj &
	ssh.obj &
	userauth2-client.obj &
	$(OBJ_SSHCOMMON)

# =================================================================
# OBJ_KEYGEN — keygen/*.c  +  root import.c
# =================================================================

OBJ_KEYGEN = &
	keygen_dsa.obj &
	ecdsa.obj &
	millerrabin.obj &
	mpunsafe.obj &
	pockle.obj &
	prime.obj &
	primecandidate.obj &
	keygen_rsa.obj &
	smallprimes.obj &
	import.obj

# =================================================================
# OBJ_TERMINAL — terminal/*.c
# =================================================================

OBJ_TERMINAL = &
	terminal.obj &
	bidi.obj &
	lineedit.obj

# =================================================================
# OBJ_PROXY — proxy/*.c
# =================================================================

OBJ_PROXY = &
	proxy.obj &
	proxy_http.obj &
	socks4.obj &
	socks5.obj &
	proxy_telnet.obj &
	local.obj &
	interactor.obj

# =================================================================
# OBJ_OTHERBACKENDS — otherbackends/*.c
# =================================================================

OBJ_OTHERBACKENDS = &
	raw.obj &
	rlogin.obj &
	supdup.obj &
	telnet.obj &
	testback.obj

# =================================================================
# OBJ_WINUTILS — windows/utils/*.c  +  windows/unicode.c
# =================================================================

OBJ_WINUTILS = &
	wu_agent_mutex_name.obj &
	wu_agent_named_pipe_name.obj &
	wu_arm_arch_queries.obj &
	wu_aux_match_opt.obj &
	wu_centre_window.obj &
	wu_cmdline_arg.obj &
	wu_cryptoapi.obj &
	wu_defaults.obj &
	wu_dll_hijacking_protection.obj &
	wu_dputs.obj &
	wu_escape_registry_key.obj &
	wu_filename.obj &
	wu_fontspec.obj &
	wu_getdlgitemtext_alloc.obj &
	wu_get_system_dir.obj &
	wu_get_username.obj &
	wu_interprocess_mutex.obj &
	wu_is_console_handle.obj &
	wu_load_system32_dll.obj &
	wu_ltime.obj &
	wu_makedlgitemborderless.obj &
	wu_make_spr_sw_abort_winerror.obj &
	wu_open_for_write_would_lose_data.obj &
	wu_platform_get_x_display.obj &
	wu_registry.obj &
	wu_request_file.obj &
	wu_security.obj &
	wu_screenshot.obj &
	wu_split_into_argv.obj &
	wu_split_into_argv_w.obj &
	wu_version.obj &
	wu_win_strerror.obj &
	wu_wmemchr.obj &
	unicode.obj

# GUI-only winutils: reference hinst (HINSTANCE).
# wu_gui-timing.obj is NOT here — it calls run_timers() so it only belongs
# in targets that have a real event loop (putty, puttytel, pageant).
OBJ_WINUTILS_GUIONLY = &
	wu_message_box.obj &
	wu_pgp_fingerprints_msgbox.obj &
	wu_shinydialogbox.obj

# =================================================================
# OBJ_WINNET — windows networking
# =================================================================

OBJ_WINNET = &
	network.obj &
	handle-io.obj &
	handle-socket.obj &
	named-pipe-client.obj &
	named-pipe-server.obj &
	local-proxy.obj

# =================================================================
# OBJ_WINEVENTLOOP — windows event loop
# =================================================================

OBJ_WINEVENTLOOP = &
	cliloop.obj &
	handle-wait.obj

# =================================================================
# OBJ_WINGUI — GUI controls / terminal window shared files
# =================================================================

OBJ_WINGUI = &
	win_dialog.obj &
	win_controls.obj &
	win_config.obj &
	printing.obj &
	jump-list.obj &
	sizetip.obj &
	select-gui.obj

# =================================================================
# Root-level shared objects
# =================================================================

# OBJ_NETSHARED: common objects needed by all network-capable targets
OBJ_NETSHARED = &
	callback.obj &
	errsock.obj &
	logging.obj &
	pinger.obj &
	timing.obj &
	x11disp.obj &
	settings.obj &
	cmdline.obj &
	win_storage.obj

# OBJ_ROOTSHARED: OBJ_NETSHARED plus SSH-specific objects for SSH targets
OBJ_ROOTSHARED = &
	$(OBJ_NETSHARED) &
	sshpubk.obj &
	openssh-certs.obj &
	sshrand.obj &
	aqsync.obj

# =================================================================
# Default target
# =================================================================

all: pageant.exe plink.exe pscp.exe psftp.exe putty.exe puttygen.exe puttytel.exe winsftp.exe .SYMBOLIC

win32s: putty.exe puttytel.exe puttygen.exe winsftp.exe .SYMBOLIC

# =================================================================
# be_list.c — per-target compilation with different defines
# =================================================================

be_list_putty.obj: ../be_list.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DAPPNAME=PuTTY -DSSH=1 -DSERIAL=1 -DOTHERBACKENDS=1 &
	    -fo=be_list_putty.obj -c ../be_list.c

be_list_puttytel.obj: ../be_list.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DAPPNAME=PuTTYtel -DSSH=0 -DSERIAL=1 -DOTHERBACKENDS=1 &
	    -fo=be_list_puttytel.obj -c ../be_list.c

be_list_plink.obj: ../be_list.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DAPPNAME=Plink -DSSH=1 -DSERIAL=1 -DOTHERBACKENDS=1 &
	    -fo=be_list_plink.obj -c ../be_list.c

be_list_pscp.obj: ../be_list.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DAPPNAME=PSCP -DSSH=1 -DSERIAL=0 -DOTHERBACKENDS=0 &
	    -fo=be_list_pscp.obj -c ../be_list.c

be_list_psftp.obj: ../be_list.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DAPPNAME=PSFTP -DSSH=1 -DSERIAL=0 -DOTHERBACKENDS=0 &
	    -fo=be_list_psftp.obj -c ../be_list.c

# =================================================================
# Resource compilation
# =================================================================

pageant.res: pageant.rc
	$(RCPATH) $(RCFLAGS) pageant.rc -o pageant.res

putty.res: putty.rc
	$(RCPATH) $(RCFLAGS) putty.rc -o putty.res

puttytel.res: puttytel.rc
	$(RCPATH) $(RCFLAGS) puttytel.rc -o puttytel.res

plink.res: plink.rc
	$(RCPATH) $(RCFLAGS) plink.rc -o plink.res

pscp.res: pscp.rc
	$(RCPATH) $(RCFLAGS) pscp.rc -o pscp.res

psftp.res: psftp.rc
	$(RCPATH) $(RCFLAGS) psftp.rc -o psftp.res

puttygen.res: puttygen.rc
	$(RCPATH) $(RCFLAGS) puttygen.rc -o puttygen.res

# =================================================================
# pageant.exe — SSH agent (GUI)
# =================================================================

PAGEANT_OBJS = &
	pageant_main.obj &
	root_pageant.obj &
	help.obj &
	nohelp.obj &
	win_agent_client.obj &
	no-jump-list.obj &
	no-rand-pageant.obj &
	$(OBJ_WINUTILS) &
	$(OBJ_WINUTILS_GUIONLY) &
	wu_gui-timing.obj &
	$(OBJ_WINNET) &
	win_x11.obj &
	handle-wait.obj &
	select-gui.obj &
	$(OBJ_CRYPTO) &
	$(OBJ_PROXY) &
	nocproxy.obj &
	nosshproxy.obj &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	sshpubk.obj &
	openssh-certs.obj &
	aqsync.obj &
	callback.obj &
	errsock.obj &
	logging.obj &
	timing.obj &
	x11disp.obj

pageant.exe: $(PAGEANT_OBJS) pageant.res
	$(CC) -bt=nt -l=nt_win -fe=$@ $(LDFLAGS) $(PAGEANT_OBJS)
	wrc pageant.res $@

# =================================================================
# plink.exe — command-line SSH/Telnet (console app)
# =================================================================

PLINK_OBJS = &
	be_list_plink.obj &
	plink.obj &
	console_root.obj &
	clicons.obj &
	win_console.obj &
	help.obj &
	nohelp.obj &
	no-term.obj &
	no-lineedit.obj &
	no-jump-list.obj &
	no-ca-config.obj &
	ldisc.obj &
	serial.obj &
	$(OBJ_ROOTSHARED) &
	$(OBJ_SSHCLIENT) &
	$(OBJ_OTHERBACKENDS) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_CRYPTO_ROOT) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_UTILS_X11) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINNET) &
	win_x11.obj &
	$(OBJ_WINEVENTLOOP) &
	select-cli.obj &
	win_sharing.obj &
	noise.obj &
	win_agent_client.obj &
	win_gss.obj

plink.exe: $(PLINK_OBJS) plink.res
	$(CC) -bt=nt -l=nt -fe=$@ $(LDFLAGS) $(PLINK_OBJS)
	wrc plink.res $@

# =================================================================
# pscp.exe — command-line SCP client
# =================================================================

PSCP_OBJS = &
	be_list_pscp.obj &
	pscp.obj &
	psftpcommon.obj &
	win_sftp.obj &
	console_root.obj &
	clicons.obj &
	win_console.obj &
	help.obj &
	nohelp.obj &
	no-lineedit.obj &
	no-jump-list.obj &
	no-ca-config.obj &
	$(OBJ_ROOTSHARED) &
	$(OBJ_SSHCLIENT) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_CRYPTO_ROOT) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_UTILS_X11) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINNET) &
	$(OBJ_WINEVENTLOOP) &
	select-cli.obj &
	win_sharing.obj &
	noise.obj &
	win_agent_client.obj &
	win_gss.obj &
	ssh_sftp.obj &
	sftpcommon.obj

pscp.exe: $(PSCP_OBJS) pscp.res
	$(CC) -bt=nt -l=nt -fe=$@ $(LDFLAGS) $(PSCP_OBJS)
	wrc pscp.res $@

# =================================================================
# psftp.exe — command-line SFTP client
# =================================================================

PSFTP_OBJS = &
	be_list_psftp.obj &
	psftp.obj &
	psftpcommon.obj &
	win_sftp.obj &
	console_root.obj &
	clicons.obj &
	win_console.obj &
	help.obj &
	nohelp.obj &
	no-lineedit.obj &
	no-jump-list.obj &
	no-ca-config.obj &
	$(OBJ_ROOTSHARED) &
	$(OBJ_SSHCLIENT) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_CRYPTO_ROOT) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_UTILS_X11) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINNET) &
	$(OBJ_WINEVENTLOOP) &
	select-cli.obj &
	win_sharing.obj &
	noise.obj &
	win_agent_client.obj &
	win_gss.obj &
	ssh_sftp.obj &
	sftpcommon.obj

psftp.exe: $(PSFTP_OBJS) psftp.res
	$(CC) -bt=nt -l=nt -fe=$@ $(LDFLAGS) $(PSFTP_OBJS)
	wrc psftp.res $@

# =================================================================
# winsftp.exe — GUI SFTP client (winsftp.c GUI wrapper for psftp)
# =================================================================

# psftp.c compiled with WINSFTP_BUILD to add progress hooks and
# redirect printf/fprintf to the GUI output area.
psftp_winsftp.obj: ../psftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DWINSFTP_BUILD=1 &
	    "-Dprintf=winsftp_printf" "-Dfprintf=winsftp_fprintf" &
	    -fo=$@ -c ../psftp.c

# windows/sftp.c compiled with WINSFTP_BUILD: keeps only file I/O
# helpers (RFile/WFile/DirHandle/etc.); strips event loop and main.
win_sftp_fileio.obj: sftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) &
	    -DWINSFTP_BUILD=1 &
	    -fo=$@ -c sftp.c

winsftp.obj: winsftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c winsftp.c

WINSFTP_OBJS = &
	be_list_psftp.obj &
	psftp_winsftp.obj &
	psftpcommon.obj &
	win_sftp_fileio.obj &
	winsftp.obj &
	help.obj &
	nohelp.obj &
	no-lineedit.obj &
	no-jump-list.obj &
	no-ca-config.obj &
	$(OBJ_ROOTSHARED) &
	$(OBJ_SSHCLIENT) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_CRYPTO_ROOT) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_UTILS_X11) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINUTILS_GUIONLY) &
	$(OBJ_WINNET) &
	cliloop.obj &
	handle-wait.obj &
	select-cli.obj &
	win_sharing.obj &
	noise.obj &
	win_agent_client.obj &
	win_gss.obj &
	ssh_sftp.obj &
	sftpcommon.obj

winsftp.exe: $(WINSFTP_OBJS) psftp.res
	$(CC) -bt=nt -l=nt_win -fe=$@ $(LDFLAGS) $(WINSFTP_OBJS)
	wrc psftp.res $@

# =================================================================
# putty.exe — GUI SSH/Telnet/Serial terminal
# =================================================================

PUTTY_OBJS = &
	be_list_putty.obj &
	window.obj &
	win_putty.obj &
	help.obj &
	nohelp.obj &
	no-console.obj &
	ca-config.obj &
	ldisc.obj &
	serial.obj &
	root_dialog.obj &
	root_config.obj &
	$(OBJ_ROOTSHARED) &
	$(OBJ_SSHCLIENT) &
	$(OBJ_OTHERBACKENDS) &
	$(OBJ_TERMINAL) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_CRYPTO_ROOT) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_UTILS_X11) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINUTILS_GUIONLY) &
	wu_gui-timing.obj &
	$(OBJ_WINNET) &
	win_x11.obj &
	handle-wait.obj &
	$(OBJ_WINGUI) &
	win_sharing.obj &
	noise.obj &
	win_agent_client.obj &
	win_gss.obj

putty.exe: $(PUTTY_OBJS) putty.res
	$(CC) -bt=nt -l=nt_win -fe=$@ $(LDFLAGS) $(PUTTY_OBJS)
	wrc putty.res $@

# =================================================================
# puttygen.exe — key generator (GUI)
# =================================================================

PUTTYGEN_OBJS = &
	puttygen_main.obj &
	help.obj &
	nohelp.obj &
	noise.obj &
	no-jump-list.obj &
	win_storage.obj &
	win_controls.obj &
	no-timing.obj &
	sshpubk.obj &
	openssh-certs.obj &
	sshrand.obj &
	$(OBJ_KEYGEN) &
	$(OBJ_CRYPTO) &
	$(OBJ_UTILS) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINUTILS_GUIONLY)

puttygen.exe: $(PUTTYGEN_OBJS) puttygen.res
	$(CC) -bt=nt -l=nt_win -fe=$@ $(LDFLAGS) $(PUTTYGEN_OBJS)
	wrc puttygen.res $@

# =================================================================
# puttytel.exe — GUI Telnet-only (no SSH)
# =================================================================

PUTTYTEL_OBJS = &
	be_list_puttytel.obj &
	window.obj &
	win_putty.obj &
	help.obj &
	nohelp.obj &
	no-gss.obj &
	no-ca-config.obj &
	no-console.obj &
	no-rand.obj &
	no-dit.obj &
	nocproxy.obj &
	nosshproxy.obj &
	ldisc.obj &
	serial.obj &
	root_dialog.obj &
	root_config.obj &
	$(OBJ_NETSHARED) &
	$(OBJ_OTHERBACKENDS) &
	$(OBJ_TERMINAL) &
	$(OBJ_PROXY) &
	$(OBJ_CRYPTO) &
	$(OBJ_UTILS) &
	$(OBJ_UTILS_SOCKETS) &
	$(OBJ_WINUTILS) &
	$(OBJ_WINUTILS_GUIONLY) &
	wu_gui-timing.obj &
	$(OBJ_WINNET) &
	win_x11.obj &
	handle-wait.obj &
	$(OBJ_WINGUI)

puttytel.exe: $(PUTTYTEL_OBJS) puttytel.res
	$(CC) -bt=nt -l=nt_win -fe=$@ $(LDFLAGS) $(PUTTYTEL_OBJS)
	wrc puttytel.res $@

# =================================================================
# Clean
# =================================================================

clean: .SYMBOLIC
	rm -f *.obj *.exe *.res *.err *.map

# =================================================================
# Per-file compilation rules — utils/
# =================================================================

antispoof.obj: ../utils/antispoof.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
backend_socket_log.obj: ../utils/backend_socket_log.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
base64_decode.obj: ../utils/base64_decode.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
base64_decode_atom.obj: ../utils/base64_decode_atom.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
base64_encode.obj: ../utils/base64_encode.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
base64_encode_atom.obj: ../utils/base64_encode_atom.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
base64_valid.obj: ../utils/base64_valid.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bufchain.obj: ../utils/bufchain.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
buildinfo.obj: ../utils/buildinfo.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
burnstr.obj: ../utils/burnstr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
burnwcs.obj: ../utils/burnwcs.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
cert-expr.obj: ../utils/cert-expr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
chomp.obj: ../utils/chomp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
cmdline_get_passwd_input_state_new.obj: ../utils/cmdline_get_passwd_input_state_new.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
conf.obj: ../utils/conf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
conf_data.obj: ../utils/conf_data.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
conf_debug.obj: ../utils/conf_debug.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
conf_dest.obj: ../utils/conf_dest.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
conf_launchable.obj: ../utils/conf_launchable.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ctrlparse.obj: ../utils/ctrlparse.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ctrlset_normalise.obj: ../utils/ctrlset_normalise.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
debug.obj: ../utils/debug.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
decode_utf8.obj: ../utils/decode_utf8.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
decode_utf8_to_wchar.obj: ../utils/decode_utf8_to_wchar.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
decode_utf8_to_wide_string.obj: ../utils/decode_utf8_to_wide_string.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
default_description.obj: ../utils/default_description.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dupcat.obj: ../utils/dupcat.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dupprintf.obj: ../utils/dupprintf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dupstr.obj: ../utils/dupstr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dupwcs.obj: ../utils/dupwcs.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dupwcscat.obj: ../utils/dupwcscat.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dup_mb_to_wc.obj: ../utils/dup_mb_to_wc.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
dup_wc_to_mb.obj: ../utils/dup_wc_to_mb.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
encode_utf8.obj: ../utils/encode_utf8.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
encode_wide_string_as_utf8.obj: ../utils/encode_wide_string_as_utf8.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
fgetline.obj: ../utils/fgetline.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_ca_new_free.obj: ../utils/host_ca_new_free.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_strchr.obj: ../utils/host_strchr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_strchr_internal.obj: ../utils/host_strchr_internal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_strcspn.obj: ../utils/host_strcspn.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_strduptrim.obj: ../utils/host_strduptrim.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
host_strrchr.obj: ../utils/host_strrchr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
key_components.obj: ../utils/key_components.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
log_proxy_stderr.obj: ../utils/log_proxy_stderr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
logeventf.obj: ../utils/logeventf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
make_spr_sw_abort_static.obj: ../utils/make_spr_sw_abort_static.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
marshal.obj: ../utils/marshal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
memory.obj: ../utils/memory.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
memxor.obj: ../utils/memxor.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
nullstrcmp.obj: ../utils/nullstrcmp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
out_of_memory.obj: ../utils/out_of_memory.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
parse_blocksize.obj: ../utils/parse_blocksize.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
percent_decode.obj: ../utils/percent_decode.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
percent_encode.obj: ../utils/percent_encode.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
prompts.obj: ../utils/prompts.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ptrlen.obj: ../utils/ptrlen.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
read_file_into.obj: ../utils/read_file_into.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
seat_connection_fatal.obj: ../utils/seat_connection_fatal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
seat_dialog_text.obj: ../utils/seat_dialog_text.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
seat_nonfatal.obj: ../utils/seat_nonfatal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sessprep.obj: ../utils/sessprep.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sk_free_peer_info.obj: ../utils/sk_free_peer_info.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
smemclr.obj: ../utils/smemclr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
smemeq.obj: ../utils/smemeq.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
spr_get_error_message.obj: ../utils/spr_get_error_message.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_key_clone.obj: ../utils/ssh_key_clone.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh2_pick_fingerprint.obj: ../utils/ssh2_pick_fingerprint.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sshutils.obj: ../utils/sshutils.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
strbuf.obj: ../utils/strbuf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
string_length_for_printf.obj: ../utils/string_length_for_printf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
stripctrl.obj: ../utils/stripctrl.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
tempseat.obj: ../utils/tempseat.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
tree234.obj: ../utils/tree234.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
unicode-known.obj: ../utils/unicode-known.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
unicode-norm.obj: ../utils/unicode-norm.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
validate_manual_hostkey.obj: ../utils/validate_manual_hostkey.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
version.obj: ../utils/version.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wcwidth.obj: ../utils/wcwidth.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wildcard.obj: ../utils/wildcard.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wordwrap.obj: ../utils/wordwrap.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
write_c_string_literal.obj: ../utils/write_c_string_literal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11authfile.obj: ../utils/x11authfile.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11authnames.obj: ../utils/x11authnames.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11_dehexify.obj: ../utils/x11_dehexify.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11_identify_auth_proto.obj: ../utils/x11_identify_auth_proto.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11_make_greeting.obj: ../utils/x11_make_greeting.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11_parse_ip.obj: ../utils/x11_parse_ip.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — stubs/null-*.c
# =================================================================

null-cipher.obj: ../stubs/null-cipher.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-key.obj: ../stubs/null-key.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-lp.obj: ../stubs/null-lp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-mac.obj: ../stubs/null-mac.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-opener.obj: ../stubs/null-opener.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-plug.obj: ../stubs/null-plug.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-seat.obj: ../stubs/null-seat.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
null-socket.obj: ../stubs/null-socket.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# stubs/no-*.c (per-target)
no-term.obj: ../stubs/no-term.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-lineedit.obj: ../stubs/no-lineedit.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-timing.obj: ../stubs/no-timing.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-gss.obj: ../stubs/no-gss.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-ca-config.obj: ../stubs/no-ca-config.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-rand.obj: ../stubs/no-rand.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-rand-pageant.obj: ../stubs/no-rand-pageant.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-dit.obj: ../stubs/no-dit.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
no-console.obj: ../stubs/no-console.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — crypto/
# =================================================================

aes-common.obj: ../crypto/aes-common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aes-select.obj: ../crypto/aes-select.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aes-sw.obj: ../crypto/aes-sw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aesgcm-common.obj: ../crypto/aesgcm-common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aesgcm-select.obj: ../crypto/aesgcm-select.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aesgcm-sw.obj: ../crypto/aesgcm-sw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aesgcm-ref-poly.obj: ../crypto/aesgcm-ref-poly.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
arcfour.obj: ../crypto/arcfour.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
argon2.obj: ../crypto/argon2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bcrypt.obj: ../crypto/bcrypt.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
blake2.obj: ../crypto/blake2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
blowfish.obj: ../crypto/blowfish.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
chacha20-poly1305.obj: ../crypto/chacha20-poly1305.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
crc32.obj: ../crypto/crc32.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
des.obj: ../crypto/des.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
diffie-hellman.obj: ../crypto/diffie-hellman.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
crypto_dsa.obj: ../crypto/dsa.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ecc-arithmetic.obj: ../crypto/ecc-arithmetic.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ecc-ssh.obj: ../crypto/ecc-ssh.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
hash_simple.obj: ../crypto/hash_simple.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
hmac.obj: ../crypto/hmac.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
kex-hybrid.obj: ../crypto/kex-hybrid.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mac.obj: ../crypto/mac.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mac_simple.obj: ../crypto/mac_simple.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
md5.obj: ../crypto/md5.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mlkem.obj: ../crypto/mlkem.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mpint.obj: ../crypto/mpint.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ntru.obj: ../crypto/ntru.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
openssh-certs.obj: ../crypto/openssh-certs.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
prng.obj: ../crypto/prng.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pubkey-pem.obj: ../crypto/pubkey-pem.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pubkey-ppk.obj: ../crypto/pubkey-ppk.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pubkey-ssh1.obj: ../crypto/pubkey-ssh1.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
rfc6979.obj: ../crypto/rfc6979.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
crypto_rsa.obj: ../crypto/rsa.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha1-common.obj: ../crypto/sha1-common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha1-select.obj: ../crypto/sha1-select.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha1-sw.obj: ../crypto/sha1-sw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha256-common.obj: ../crypto/sha256-common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha256-select.obj: ../crypto/sha256-select.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha256-sw.obj: ../crypto/sha256-sw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha3.obj: ../crypto/sha3.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha512-common.obj: ../crypto/sha512-common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha512-select.obj: ../crypto/sha512-select.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sha512-sw.obj: ../crypto/sha512-sw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
xdmauth.obj: ../crypto/xdmauth.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — ssh/
# =================================================================

agentf.obj: ../ssh/agentf.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bpp-bare.obj: ../ssh/bpp-bare.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bpp1.obj: ../ssh/bpp1.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bpp2.obj: ../ssh/bpp2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ca-config.obj: ../ssh/ca-config.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

ssh_censor1.obj: ../ssh/censor1.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_censor2.obj: ../ssh/censor2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_common.obj: ../ssh/common.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
connection1.obj: ../ssh/connection1.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
connection1-client.obj: ../ssh/connection1-client.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
connection2.obj: ../ssh/connection2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
connection2-client.obj: ../ssh/connection2-client.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
crc-attack-detector.obj: ../ssh/crc-attack-detector.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
gssc.obj: ../ssh/gssc.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
kex2-client.obj: ../ssh/kex2-client.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
login1.obj: ../ssh/login1.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mainchan.obj: ../ssh/mainchan.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pgssapi.obj: ../ssh/pgssapi.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
portfwd.obj: ../ssh/portfwd.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_sharing.obj: ../ssh/sharing.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh.obj: ../ssh/ssh.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
transient-hostkey-cache.obj: ../ssh/transient-hostkey-cache.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
transport2.obj: ../ssh/transport2.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
userauth2-client.obj: ../ssh/userauth2-client.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
verstring.obj: ../ssh/verstring.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11fwd.obj: ../ssh/x11fwd.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_zlib.obj: ../ssh/zlib.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ssh_sftp.obj: ../ssh/sftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sftpcommon.obj: ../ssh/sftpcommon.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — keygen/
# =================================================================

keygen_dsa.obj: ../keygen/dsa.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ecdsa.obj: ../keygen/ecdsa.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
millerrabin.obj: ../keygen/millerrabin.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
mpunsafe.obj: ../keygen/mpunsafe.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pockle.obj: ../keygen/pockle.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
prime.obj: ../keygen/prime.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
primecandidate.obj: ../keygen/primecandidate.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
keygen_rsa.obj: ../keygen/rsa.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
smallprimes.obj: ../keygen/smallprimes.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — terminal/
# =================================================================

terminal.obj: ../terminal/terminal.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
bidi.obj: ../terminal/bidi.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
lineedit.obj: ../terminal/lineedit.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — proxy/
# =================================================================

proxy.obj: ../proxy/proxy.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
proxy_http.obj: ../proxy/http.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
socks4.obj: ../proxy/socks4.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
socks5.obj: ../proxy/socks5.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
proxy_telnet.obj: ../proxy/telnet.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
local.obj: ../proxy/local.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
interactor.obj: ../proxy/interactor.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
proxy_cproxy.obj: ../proxy/cproxy.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sshproxy.obj: ../proxy/sshproxy.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
nocproxy.obj: ../proxy/nocproxy.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
nosshproxy.obj: ../proxy/nosshproxy.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — otherbackends/
# =================================================================

raw.obj: ../otherbackends/raw.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
rlogin.obj: ../otherbackends/rlogin.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
supdup.obj: ../otherbackends/supdup.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
telnet.obj: ../otherbackends/telnet.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
testback.obj: ../otherbackends/testback.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — root-level .c files
# =================================================================

commit.obj: ../commit.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
root_config.obj: ../config.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
root_dialog.obj: ../dialog.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
console_root.obj: ../console.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
clicons.obj: ../clicons.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
root_pageant.obj: ../pageant.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
callback.obj: ../callback.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
errsock.obj: ../errsock.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
import.obj: ../import.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
ldisc.obj: ../ldisc.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
logging.obj: ../logging.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pinger.obj: ../pinger.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
pscp.obj: ../pscp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
psftpcommon.obj: ../psftpcommon.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
psftp.obj: ../psftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
settings.obj: ../settings.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
cmdline.obj: ../cmdline.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sshpubk.obj: ../sshpubk.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
sshrand.obj: ../sshrand.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
timing.obj: ../timing.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
aqsync.obj: ../aqsync.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
x11disp.obj: ../x11disp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# =================================================================
# Per-file compilation rules — windows/ top-level
# Note: files whose basenames clash with other directories get a
# win_ or win_<name> prefix to avoid .obj name collisions.
# =================================================================

# windows/pageant.c = the agent *application* entry point.
# (Root pageant.c is the cross-platform agent logic; it is listed
#  above as part of OBJ_ROOTSHARED where needed.)
pageant_main.obj: pageant.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_agent_client.obj: agent-client.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_console.obj: console.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_controls.obj: controls.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_config.obj: config.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_dialog.obj: dialog.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_gss.obj: gss.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_putty.obj: putty.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_sftp.obj: sftp.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_sharing.obj: sharing.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_storage.obj: storage.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

win_x11.obj: x11.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

puttygen_main.obj: puttygen.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# Files whose basenames are unambiguous (no prefix needed):
cliloop.obj: cliloop.c
handle-io.obj: handle-io.c
handle-socket.obj: handle-socket.c
handle-wait.obj: handle-wait.c
help.obj: help.c
jump-list.obj: jump-list.c
local-proxy.obj: local-proxy.c
named-pipe-client.obj: named-pipe-client.c
named-pipe-server.obj: named-pipe-server.c
network.obj: network.c
noise.obj: noise.c
no-jump-list.obj: no-jump-list.c
nohelp.obj: nohelp.c
plink.obj: plink.c
printing.obj: printing.c
select-cli.obj: select-cli.c
select-gui.obj: select-gui.c
serial.obj: serial.c
sizetip.obj: sizetip.c
unicode.obj: unicode.c
window.obj: window.c

# =================================================================
# Per-file compilation rules — windows/utils/
# =================================================================

wu_agent_mutex_name.obj: utils/agent_mutex_name.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_agent_named_pipe_name.obj: utils/agent_named_pipe_name.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_arm_arch_queries.obj: utils/arm_arch_queries.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_aux_match_opt.obj: utils/aux_match_opt.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_centre_window.obj: utils/centre_window.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_cmdline_arg.obj: utils/cmdline_arg.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_cryptoapi.obj: utils/cryptoapi.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_defaults.obj: utils/defaults.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_dll_hijacking_protection.obj: utils/dll_hijacking_protection.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_dputs.obj: utils/dputs.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_escape_registry_key.obj: utils/escape_registry_key.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_filename.obj: utils/filename.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_fontspec.obj: utils/fontspec.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_getdlgitemtext_alloc.obj: utils/getdlgitemtext_alloc.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_get_system_dir.obj: utils/get_system_dir.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_get_username.obj: utils/get_username.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_gui-timing.obj: utils/gui-timing.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_interprocess_mutex.obj: utils/interprocess_mutex.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_is_console_handle.obj: utils/is_console_handle.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_load_system32_dll.obj: utils/load_system32_dll.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_ltime.obj: utils/ltime.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_makedlgitemborderless.obj: utils/makedlgitemborderless.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_make_spr_sw_abort_winerror.obj: utils/make_spr_sw_abort_winerror.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_message_box.obj: utils/message_box.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_open_for_write_would_lose_data.obj: utils/open_for_write_would_lose_data.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_pgp_fingerprints_msgbox.obj: utils/pgp_fingerprints_msgbox.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_platform_get_x_display.obj: utils/platform_get_x_display.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_registry.obj: utils/registry.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_request_file.obj: utils/request_file.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_screenshot.obj: utils/screenshot.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_security.obj: utils/security.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_shinydialogbox.obj: utils/shinydialogbox.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_split_into_argv.obj: utils/split_into_argv.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_split_into_argv_w.obj: utils/split_into_argv_w.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_strtoumax.obj: utils/strtoumax.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_version.obj: utils/version.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_win_strerror.obj: utils/win_strerror.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<
wu_wmemchr.obj: utils/wmemchr.c
	$(CC) $(COMPAT) $(CFLAGS) $(XFLAGS) -fo=$@ -c $<

# end of Makefile.wc
